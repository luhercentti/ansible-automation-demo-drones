ansible-automation-demo-drones/
â”‚
â”œâ”€â”€ ğŸ“„ ansible.cfg                      # ConfiguraciÃ³n de Ansible
â”œâ”€â”€ ğŸ“„ site.yml                         # Playbook principal de despliegue
â”œâ”€â”€ ğŸ“„ update.yml                       # Playbook de actualizaciÃ³n
â”œâ”€â”€ ğŸ“„ undeploy.yml                     # Playbook de eliminaciÃ³n
â”œâ”€â”€ ğŸ“„ Makefile                         # Comandos simplificados
â”‚
â”œâ”€â”€ ï¿½ï¿½ DocumentaciÃ³n
â”‚   â”œâ”€â”€ ğŸ“„ README.md                    # DocumentaciÃ³n principal
â”‚   â”œâ”€â”€ ğŸ“„ QUICKSTART.md                # GuÃ­a de inicio rÃ¡pido
â”‚   â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md              # Arquitectura detallada
â”‚   â”œâ”€â”€ ğŸ“„ EXAMPLES.md                  # Ejemplos de uso
â”‚   â”œâ”€â”€ ğŸ“„ REQUIREMENTS.txt             # Requisitos del sistema
â”‚   â”œâ”€â”€ ğŸ“„ CONTRIBUTING.md              # GuÃ­a de contribuciÃ³n
â”‚   â”œâ”€â”€ ğŸ“„ CHANGELOG.md                 # Historial de cambios
â”‚   â””â”€â”€ ğŸ“„ LICENSE                      # Licencia MIT
â”‚
â”œâ”€â”€ ğŸ“ inventory/                       # Inventarios de Ansible
â”‚   â””â”€â”€ ğŸ“„ hosts.yml                    # Hosts objetivo
â”‚
â”œâ”€â”€ ğŸ“ group_vars/                      # Variables globales
â”‚   â””â”€â”€ ğŸ“„ all.yml                      # Variables para todos los hosts
â”‚
â”œâ”€â”€ ğŸ“ roles/                           # Roles de Ansible
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ common/                      # Prerequisitos del sistema
â”‚   â”‚   â”œâ”€â”€ ğŸ“ meta/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â””â”€â”€ ğŸ“ tasks/
â”‚   â”‚       â””â”€â”€ ğŸ“„ main.yml             # Docker, Python, dependencias
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ clickhouse/                  # Base de datos ClickHouse
â”‚   â”‚   â”œâ”€â”€ ğŸ“ defaults/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â”œâ”€â”€ ğŸ“ meta/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â””â”€â”€ ğŸ“ tasks/
â”‚   â”‚       â””â”€â”€ ğŸ“„ main.yml             # InstalaciÃ³n y configuraciÃ³n
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ kafka/                       # Apache Kafka + Zookeeper
â”‚   â”‚   â”œâ”€â”€ ğŸ“ defaults/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â”œâ”€â”€ ğŸ“ meta/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â””â”€â”€ ğŸ“ tasks/
â”‚   â”‚       â””â”€â”€ ğŸ“„ main.yml             # Broker, topics, Kafka Connect
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ thingsboard/                 # Plataforma IoT ThingsBoard
â”‚   â”‚   â”œâ”€â”€ ğŸ“ defaults/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â”œâ”€â”€ ğŸ“ meta/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â””â”€â”€ ğŸ“ tasks/
â”‚   â”‚       â””â”€â”€ ğŸ“„ main.yml             # ThingsBoard + PostgreSQL
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ monitoring/                  # Stack de monitoreo
â”‚   â”‚   â”œâ”€â”€ ğŸ“ defaults/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â”œâ”€â”€ ğŸ“ meta/
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚   â”‚   â””â”€â”€ ğŸ“ tasks/
â”‚   â”‚       â””â”€â”€ ğŸ“„ main.yml             # Grafana, Prometheus, Node Exporter
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ drone_simulator/             # Simulador de drones
â”‚       â”œâ”€â”€ ğŸ“ meta/
â”‚       â”‚   â””â”€â”€ ğŸ“„ main.yml
â”‚       â””â”€â”€ ğŸ“ tasks/
â”‚           â””â”€â”€ ğŸ“„ main.yml             # Scripts Python, systemd service
â”‚
â”œâ”€â”€ ğŸ“ scripts/                         # Scripts utilitarios
â”‚   â”œâ”€â”€ ğŸ“„ verify-deployment.sh         # Verificar estado del sistema
â”‚   â”œâ”€â”€ ğŸ“„ start-all.sh                 # Iniciar todos los servicios
â”‚   â”œâ”€â”€ ğŸ“„ stop-all.sh                  # Detener servicios
â”‚   â”œâ”€â”€ ğŸ“„ cleanup.sh                   # Limpieza completa
â”‚   â”œâ”€â”€ ğŸ“„ backup.sh                    # Backup de datos
â”‚   â””â”€â”€ ğŸ“„ setup-kafka-connect.py       # Configurar Kafka Connect
â”‚
â”œâ”€â”€ ğŸ“ config/                          # Archivos de configuraciÃ³n
â”‚   â””â”€â”€ ğŸ“„ kafka-connect-clickhouse.json # Config de Kafka Connect Sink
â”‚
â”œâ”€â”€ ğŸ“ docs/                            # DocumentaciÃ³n adicional
â”‚   â”œâ”€â”€ ğŸ“„ README.md                    # Ãndice de documentaciÃ³n
â”‚   â””â”€â”€ ğŸ“„ clickhouse-queries.sql       # Consultas SQL Ãºtiles
â”‚
â””â”€â”€ ğŸ“„ .gitignore                       # Archivos ignorados por Git


ğŸš€ ARQUITECTURA DEL SISTEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Drones    â”‚  (5 simuladores Python)
â”‚  MQTT Pub   â”‚  TelemetrÃ­a cada 15s
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ MQTT (1883)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ThingsBoard CE     â”‚  Plataforma IoT
â”‚  - Device Mgmt       â”‚  HTTP: 8080
â”‚  - Rule Engine        â”‚  MQTT: 1883
â”‚  - PostgreSQL DB     â”‚  CoAP: 5683
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Kafka Producer
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Apache Kafka       â”‚  MensajerÃ­a
â”‚  - Zookeeper (2181)  â”‚  Broker: 9092
â”‚  - Topic: telemetry  â”‚  Partitions: 3
â”‚  - Kafka Connect     â”‚  Connect: 8083
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Consumer / Connect
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ClickHouse         â”‚  Base de datos
â”‚  - Columnar DB       â”‚  HTTP: 8123
â”‚  - Time Series       â”‚  Native: 9000
â”‚  - Partitioned       â”‚  DB: drone_telemetry
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Queries
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Grafana + Prometheus â”‚  Monitoreo
â”‚  - Dashboards        â”‚  Grafana: 3000
â”‚  - Metrics           â”‚  Prometheus: 9090
â”‚  - Alerts            â”‚  Node Exp: 9100
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ“Š FLUJO DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Drones â†’ MQTT â†’ ThingsBoard
   - 5 drones enviando datos cada 15 segundos
   - Protocolo MQTT (lightweight)
   - Datos: GPS, baterÃ­a, velocidad, temperatura, estado

2. ThingsBoard â†’ Kafka
   - Rule chain procesa datos
   - Publica en topic "drone-telemetry"
   - JSON serialization

3. Kafka â†’ ClickHouse
   - Kafka Connect Sink (opcional)
   - Batch inserts (1000 registros o 10s)
   - Almacenamiento persistente

4. ClickHouse â†’ Grafana
   - Consultas SQL optimizadas
   - Dashboards en tiempo real
   - AnÃ¡lisis histÃ³rico


ğŸ¯ DATOS GESTIONADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Cada mensaje de telemetrÃ­a contiene:
  - timestamp: DateTime con precisiÃ³n de milisegundos
  - drone_id: Identificador Ãºnico (DRONE_001..005)
  - latitude, longitude: PosiciÃ³n GPS (Float64)
  - altitude: Altitud en metros (Float64)
  - battery_level: Porcentaje de baterÃ­a (Float32)
  - speed: Velocidad en m/s (Float32)
  - temperature: Temperatura en Â°C (Float32)
  - status: Estado (ACTIVE, RETURNING, CRITICAL)
  - mission_id: ID de misiÃ³n asignada


ğŸ’¾ PERSISTENCIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Datos almacenados en: /opt/drone-telemetry/

  â”œâ”€â”€ data/
  â”‚   â”œâ”€â”€ clickhouse/      (~10GB para 1M registros)
  â”‚   â”œâ”€â”€ kafka/           (~5GB con 7 dÃ­as retention)
  â”‚   â”œâ”€â”€ zookeeper/       (~100MB)
  â”‚   â”œâ”€â”€ thingsboard/     (~2GB)
  â”‚   â”‚   â”œâ”€â”€ data/
  â”‚   â”‚   â””â”€â”€ postgres/
  â”‚   â”œâ”€â”€ grafana/         (~500MB)
  â”‚   â””â”€â”€ prometheus/      (~2GB, 15 dÃ­as retention)
  â”‚
  â”œâ”€â”€ logs/
  â”‚   â”œâ”€â”€ thingsboard/
  â”‚   â””â”€â”€ drone-simulator/
  â”‚
  â””â”€â”€ config/
      â”œâ”€â”€ clickhouse/
      â”œâ”€â”€ monitoring/
      â””â”€â”€ kafka-connect-docker-compose.yml


ğŸ”§ COMANDOS PRINCIPALES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Despliegue:
  make deploy              # Desplegar todo el sistema
  make deploy-clickhouse   # Solo ClickHouse
  make deploy-kafka        # Solo Kafka
  make deploy-thingsboard  # Solo ThingsBoard

GestiÃ³n:
  make verify              # Verificar estado
  make status              # Ver recursos
  make start               # Iniciar servicios
  make stop                # Detener servicios
  make restart             # Reiniciar todo

Drones:
  make provision-devices   # Crear drones en ThingsBoard
  make start-drones        # Iniciar simulaciÃ³n

Logs:
  make logs                # Ver todos los logs
  make logs-thingsboard    # Logs de ThingsBoard
  make logs-kafka          # Logs de Kafka
  make logs-clickhouse     # Logs de ClickHouse

Datos:
  make backup              # Crear backup
  make query-drones        # Consultar drones en ClickHouse
  make shell-clickhouse    # Shell interactivo

Limpieza:
  make clean               # Limpiar todo (PELIGROSO)
  make undeploy            # Eliminar despliegue


ğŸ“ˆ MÃ‰TRICAS CLAVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Sistema:
  - Drones activos: 5
  - Mensajes/segundo: ~0.33 (5 drones / 15s)
  - Mensajes/dÃ­a: ~28,800
  - Almacenamiento/dÃ­a: ~50MB (comprimido)

Performance:
  - Latencia MQTT â†’ ThingsBoard: <100ms
  - Latencia ThingsBoard â†’ Kafka: <50ms
  - Latencia Kafka â†’ ClickHouse: <1s
  - Query time (ClickHouse): <100ms

Recursos (mÃ­nimos):
  - CPU: 4 cores
  - RAM: 8 GB
  - Disco: 50 GB


ğŸ“ BUENAS PRÃCTICAS IMPLEMENTADAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DevOps:
  âœ“ Infrastructure as Code (Ansible)
  âœ“ Idempotencia en todos los roles
  âœ“ Variables centralizadas
  âœ“ Secrets configurables
  âœ“ Tags para despliegues selectivos

Arquitectura:
  âœ“ SeparaciÃ³n de responsabilidades
  âœ“ Escalabilidad horizontal preparada
  âœ“ Persistencia de datos garantizada
  âœ“ Monitoreo integrado
  âœ“ Logs centralizados

CÃ³digo:
  âœ“ DocumentaciÃ³n completa
  âœ“ Scripts reutilizables
  âœ“ Manejo de errores
  âœ“ Validaciones pre-despliegue
  âœ“ Cleanup automatizado

